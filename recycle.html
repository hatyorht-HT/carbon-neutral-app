<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <meta name="description" content="å‘å¸ƒç»¿è‰²é—²ç½®ï¼Œä¸ºåœ°çƒå‡ç¢³ï¼Œè·å¾—ç»¿åˆ†å¥–åŠ±ã€‚">
    <title>å‘å¸ƒé—²ç½® - ç¢³ä¸­å’Œæ ¡å›­</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <h1>å‘å¸ƒç»¿è‰²é—²ç½®</h1>
        
        <!-- é¡µé¢å‰¯æ ‡é¢˜ -->
        <div class="card" style="background-color: #f0fdf4; margin-bottom: 24px;">
            <h3>ä¸Šä¼ ä½ çš„é—²ç½®ï¼ŒåŠ©åŠ›ç¢³å‡æ’</h3>
            <p style="color: #666; font-size: 14px; margin-top: 8px;">ä½ çš„æ¯ä¸€æ¬¡å›æ”¶éƒ½åœ¨å®ˆæŠ¤åœ°çƒã€‚</p>
        </div>
        
        <!-- å·²ç™»å½•çŠ¶æ€å†…å®¹ -->
        <div id="publishForm" style="display: none;">
            <!-- æ·»åŠ ç…§ç‰‡åŒºåŸŸ -->
            <div class="photo-upload">
                <div id="photoPreview" style="font-size: 48px; margin-bottom: 12px;">ğŸ“·</div>
                <h3>æ·»åŠ ç…§ç‰‡</h3>
                <p style="color: #666; font-size: 14px; margin: 8px 0 16px;">ä¸Šä¼ ä¸€å¼ æ¸…æ™°çš„ç‰©å“ç…§ç‰‡</p>
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">é€‰æ‹©å›¾ç‰‡</button>
                <input type="file" id="fileInput" style="display: none;" accept="image/*" onchange="previewImage(this)">
            </div>
            
            <!-- è¡¨å• -->
            <div class="card">
                <h3>ç‰©å“åç§°</h3>
                <input type="text" id="itemName" placeholder="ä¾‹å¦‚ï¼šä¸­å¤ç»ç’ƒç“¶">
                
                <h3>ç±»åˆ«é€‰æ‹©</h3>
                <select id="itemCategory">
                    <option value="">é€‰æ‹©ç±»åˆ«</option>
                    <option value="digital">æ•°ç </option>
                    <option value="clothing">è¡£ç‰©</option>
                    <option value="books">ä¹¦ç±</option>
                    <option value="other">å…¶ä»–</option>
                </select>
                
                <h3>æ–°æ—§ç¨‹åº¦</h3>
                <div class="radio-group">
                    <div class="radio-option">å…¨æ–°</div>
                    <div class="radio-option active">ä¹æˆæ–°</div>
                    <div class="radio-option">ä¸€èˆ¬</div>
                </div>
                
                <h3>ä»·æ ¼ï¼ˆå…ƒï¼‰</h3>
                <input type="number" id="itemPrice" placeholder="ä¾‹å¦‚ 20" min="0" step="1" required>
                
                <!-- é¢„ä¼°å¥–åŠ± -->
                <div style="background-color: #f0fdf4; border-radius: 8px; padding: 16px; margin: 16px 0;">
                    <h3 style="margin-bottom: 8px;">é¢„ä¼°å¥–åŠ±</h3>
                    <div style="font-size: 18px; font-weight: 700; color: #2ecc71;">é¢„è®¡å¯å¾—ç§¯åˆ† 10</div>
                </div>
                
                <!-- ç«‹å³å‘å¸ƒæŒ‰é’® -->
                <button class="btn" onclick="submitForm()">ç«‹å³å‘å¸ƒ</button>
                
                <p style="text-align: center; font-size: 12px; color: #999; margin-top: 12px;">å‘å¸ƒå³ä»£è¡¨æ‚¨åŒæ„æˆ‘ä»¬çš„<a href="#" onclick="alert('ç¤¾åŒºå‡†åˆ™å†…å®¹ï¼ˆæš‚ç•¥ï¼‰'); return false;">ç¤¾åŒºå‡†åˆ™</a></p>
            </div>
        </div>
        
        <!-- æœªç™»å½•çŠ¶æ€å†…å®¹ -->
        <div id="publishLoginPrompt" style="text-align: center; padding: 60px 20px; background-color: white; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
            <span style="font-size: 48px;">ğŸ“¦</span>
            <p style="font-size: 18px; margin: 20px 0;">ç™»å½•åå³å¯å‘å¸ƒç»¿è‰²é—²ç½®</p>
            <button style="background-color: #2ecc71; color: white; border: none; border-radius: 8px; padding: 14px 32px; font-size: 16px; font-weight: 500; cursor: pointer; min-height: 44px; min-width: 120px;" onclick="window.location.href='login.html'">å»ç™»å½•</button>
        </div>
        
        <script>
            function submitForm() {
                const itemName = document.getElementById('itemName').value;
                const itemCategory = document.getElementById('itemCategory').value;
                
                if (!itemName) {
                    alert('è¯·è¾“å…¥ç‰©å“åç§°');
                    return;
                }
                
                if (!itemCategory) {
                    alert('è¯·é€‰æ‹©ç±»åˆ«');
                    return;
                }
                
                alert('å‘å¸ƒæˆåŠŸï¼æ‚¨çš„é—²ç½®å·²æäº¤å®¡æ ¸');
                
                // æ¸…ç©ºè¡¨å•
                document.getElementById('fileInput').value = '';
                document.getElementById('itemName').value = '';
                document.getElementById('itemCategory').value = '';
                
                // é‡ç½®ç…§ç‰‡é¢„è§ˆ
                document.getElementById('photoPreview').innerHTML = 'ğŸ“·';
                
                // é‡ç½®æ–°æ—§ç¨‹åº¦ä¸ºä¹æˆæ–°
                const radioOptions = document.querySelectorAll('.radio-option');
                radioOptions.forEach(opt => opt.classList.remove('active'));
                radioOptions[1].classList.add('active');
            }
            
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            function checkLoginStatus() {
                const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                const publishForm = document.getElementById('publishForm');
                const publishLoginPrompt = document.getElementById('publishLoginPrompt');
                
                if (isLoggedIn) {
                    publishForm.style.display = 'block';
                    publishLoginPrompt.style.display = 'none';
                } else {
                    publishForm.style.display = 'none';
                    publishLoginPrompt.style.display = 'block';
                }
            }
            
            // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
            window.onload = checkLoginStatus;
        </script>
    </div>
    
    <script src="js/auth.js"></script>
    <script src="js/script.js"></script>
    <script>
        // é¢„è§ˆä¸Šä¼ çš„å›¾ç‰‡
        function previewImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                const preview = document.getElementById('photoPreview');
                
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 200px; object-fit: cover; border-radius: 8px;">`;
                }
                
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        // è¡¨å•å®æ—¶éªŒè¯
        document.addEventListener('DOMContentLoaded', function() {
            const itemNameInput = document.getElementById('itemName');
            const itemCategorySelect = document.getElementById('itemCategory');
            const radioOptions = document.querySelectorAll('.radio-option');
            
            // ç‰©å“åç§°éªŒè¯
            itemNameInput.addEventListener('blur', function() {
                const errorId = 'itemNameError';
                if (!this.value.trim()) {
                    showError(this, errorId, 'ç‰©å“åç§°ä¸èƒ½ä¸ºç©º');
                } else {
                    hideError(errorId);
                }
            });
            
            // ç±»åˆ«é€‰æ‹©éªŒè¯
            itemCategorySelect.addEventListener('change', function() {
                const errorId = 'itemCategoryError';
                if (!this.value) {
                    showError(this, errorId, 'è¯·é€‰æ‹©ç±»åˆ«');
                } else {
                    hideError(errorId);
                }
            });
            
            // æ–°æ—§ç¨‹åº¦é€‰æ‹©
            radioOptions.forEach(option => {
                option.addEventListener('click', function() {
                    radioOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        });
        
        // æ˜¾ç¤ºé”™è¯¯æç¤º
        function showError(element, errorId, message) {
            hideError(errorId);
            const errorElement = document.createElement('div');
            errorElement.id = errorId;
            errorElement.className = 'error-message';
            errorElement.textContent = message;
            element.parentNode.insertBefore(errorElement, element.nextSibling);
        }
        
        // éšè—é”™è¯¯æç¤º
        function hideError(errorId) {
            const errorElement = document.getElementById(errorId);
            if (errorElement) {
                errorElement.remove();
            }
        }
        
        // æäº¤è¡¨å•
        function submitForm() {
            const itemName = document.getElementById('itemName').value;
            const itemCategory = document.getElementById('itemCategory').value;
            const itemPrice = parseFloat(document.getElementById('itemPrice').value) || 0;
            const submitBtn = document.querySelector('.btn');
            
            // éªŒè¯
            let isValid = true;
            
            if (!itemName.trim()) {
                showError(document.getElementById('itemName'), 'itemNameError', 'ç‰©å“åç§°ä¸èƒ½ä¸ºç©º');
                isValid = false;
            }
            
            if (!itemCategory) {
                showError(document.getElementById('itemCategory'), 'itemCategoryError', 'è¯·é€‰æ‹©ç±»åˆ«');
                isValid = false;
            }
            
            if (itemPrice < 0) {
                showError(document.getElementById('itemPrice'), 'itemPriceError', 'ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°');
                isValid = false;
            }
            
            if (!isValid) {
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'å‘å¸ƒä¸­...';
            submitBtn.disabled = true;
            submitBtn.classList.add('btn-loading');
            
            // æ¨¡æ‹Ÿæäº¤å»¶è¿Ÿ
            setTimeout(function() {
                // æ„é€ ç‰©å“å¯¹è±¡
                const item = {
                    id: Date.now(),
                    name: itemName,
                    category: getCategoryName(itemCategory),
                    condition: getCondition(),
                    price: itemPrice,
                    publisher: 'æ—å°ç»¿', // ä»ç™»å½•ç”¨æˆ·è·å–ï¼ˆç›®å‰å›ºå®šï¼‰
                    time: 'åˆšåˆš',
                    image: 'ğŸ“·' // æ·»åŠ é»˜è®¤å›¾ç‰‡å ä½ç¬¦
                };
                
                // å­˜å…¥ localStorage
                const usedItems = JSON.parse(localStorage.getItem('usedItems') || '[]');
                usedItems.unshift(item); // æ·»åŠ åˆ°æ•°ç»„å¼€å¤´
                localStorage.setItem('usedItems', JSON.stringify(usedItems));
                
                // å¢åŠ å‘å¸ƒè€…ç§¯åˆ†
                const user = localStorage.getItem('username') || 'æ—å°ç»¿';
                const key = `points_${user}`;
                const currentPoints = parseInt(localStorage.getItem(key)) || 0;
                const newPoints = currentPoints + 10;
                localStorage.setItem(key, newPoints.toString());
                
                alert('å‘å¸ƒæˆåŠŸï¼æ‚¨çš„é—²ç½®å·²æäº¤å®¡æ ¸ï¼Œè·å¾—10ç§¯åˆ†å¥–åŠ±');
                
                // æ¸…ç©ºè¡¨å•
                document.getElementById('fileInput').value = '';
                document.getElementById('itemName').value = '';
                document.getElementById('itemCategory').value = '';
                document.getElementById('itemPrice').value = '';
                
                // é‡ç½®ç…§ç‰‡é¢„è§ˆ
                document.getElementById('photoPreview').innerHTML = 'ğŸ“·';
                
                // é‡ç½®æ–°æ—§ç¨‹åº¦ä¸ºä¹æˆæ–°
                const radioOptions = document.querySelectorAll('.radio-option');
                radioOptions.forEach(opt => opt.classList.remove('active'));
                radioOptions[1].classList.add('active');
                
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
                submitBtn.classList.remove('btn-loading');
            }, 800);
        }
        
        // è·å–ç±»åˆ«åç§°
        function getCategoryName(categoryValue) {
            switch(categoryValue) {
                case 'digital':
                    return 'æ•°ç ';
                case 'clothing':
                    return 'è¡£ç‰©';
                case 'books':
                    return 'ä¹¦ç±';
                case 'other':
                    return 'å…¶ä»–';
                default:
                    return 'å…¶ä»–';
            }
        }
        
        // è·å–æ–°æ—§ç¨‹åº¦
        function getCondition() {
            const radioOptions = document.querySelectorAll('.radio-option');
            for (let i = 0; i < radioOptions.length; i++) {
                if (radioOptions[i].classList.contains('active')) {
                    return radioOptions[i].textContent;
                }
            }
            return 'ä¹æˆæ–°'; // é»˜è®¤å€¼
        }
        
        // æ ¹æ®ç±»åˆ«è®¡ç®—ç§¯åˆ†
        function calculatePoints(categoryValue) {
            switch(categoryValue) {
                case 'digital':
                    return 20;
                case 'clothing':
                    return 10;
                case 'books':
                    return 5;
                case 'other':
                    return 15;
                default:
                    return 15;
            }
        }
    </script>
    <script src="js/footer.js"></script>
</body>
</html>